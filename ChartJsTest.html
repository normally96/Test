<!doctype html>
<html>

<head>
	<title>Line Chart</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

<body>
	<div class = "row">							<!-- dùng bootstrap tạo định dạng cho trang wed -->
		<div class="col-sm-5">
			<div class = "row">
				<div class="col-sm-1"></div>

				<div class="col-sm-11">
					<label for="ex1">Sensor</label>
					<input class="form-control" id="getSensor" type="text">
					<button id="chartemit" type="button" class="btn btn-danger">Update chart</button>
					<div class ="row">
						<div class="col-sm-3">
							<h3>From time</h3>
                  			<h3>To time</h3>
						</div>

						<div class="col-sm-3">
							<label for="ex1">Date</label>
		        			<input class="form-control" id="fromDate" type="text">
		        			<label for="ex1">Date</label>
		        			<input class="form-control" id="toDate" type="text">
						</div>
						<div class="col-sm-3">
							<label for="ex2">Hour</label>
        					<input class="form-control" id="fromHour" type="text">
        					<label for="ex2">Hour</label>
        					<input class="form-control" id="toHour" type="text">
						</div>
						<div class="col-sm-3">
							<label for="ex2">Minute</label>
        					<input class="form-control" id="fromMinute" type="text">
        					<label for="ex2">Minute</label>
        					<input class="form-control" id="toMinute" type="text">
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-sm-7">
			<canvas id="myChart"  style="width:80%;height:250px;"></canvas>
		</div>
	</div>
	
	
	<div style="width:75%;">
		
	</div>
	<br>
	<br>
	<script>
		var socket = io();
      		 $("#chartemit").click(function(){      	
      		 var timeGet= {                             // tạo hàm lấy thời gian Input
      		 	from : [$("#fromDate").val(),$("#fromHour").val(),$("#fromMinute").val()],
      		 	to   : [$("#toDate").val(),$("#toHour").val(),$("#toMinute").val()]
      		 };      
      		 timeGet.sensor = $("#getSensor").val();    
          	 socket.emit('chartemit',timeGet);   	// phát động tin nhắn chartemit với tham sô timeGet chứa thời gian và sensor cần lấy
          	        
      	});

      	socket.on('updateChartJs', (msg)=>{		// khi có sự kiện updateChartJs thì tạo chart với tham dữ liệu msg
       		var newLocations = msg;
      		initChart("myChart", $("#getSensor").val(), msg);
       	});

      	function addData(chart, label, data) {     // hàm thêm Data vào Chart
  			chart.data.labels.push(label);
			chart.data.datasets.forEach((dataset) => {
    		dataset.data.push(data);
  			});
  		  	chart.update();
		}
		function initChart(elementID, labels, data) {			// hàm tạo chart đầu tiên
			var ctx = document.getElementById(elementID);
			window.myLineChart = new Chart(ctx, {
	  			type: 'line',
	  		  	data: {
		       		labels: data,
		      		datasets: [{
		         		label: labels,
		          		data: data,
		           		backgroundColor: [
		                 	'rgba(0, 255, 0, 0.3)'
		            	],
		            	borderColor: [
		                	'rgba(255,99,132,1)'
		            	],
		           		borderWidth: 1,
		           		lineTension : 0.1
		        	}]
	   			},
	  		  	options: {
	  		  		
		       		scales: {
		  		  		yAxes: [{
		       				ticks: {
		          				beginAtZero:false
		       			 	}
		   			 	}]
	       			}
	    		}
			});

		}

      	
	</script>
</body>

</html>
